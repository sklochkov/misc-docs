# Прокси-сервер своими руками

## Предисловие

Я решил написать эту статью в связи с печальными событиями последнего времени,
которые привели к недоступности многих интернет-ресурсов по обе стороны
коричневого занавеса. Надеюсь, мне удастся помочь хоть кому-нибудь решить
внезапно возникшие у них проблемы; в моем случае это - невозможность
удаленной оплаты коммунальных услуг из-за пределов Необъятной.

Я прекрасно отдаю себе отчет в том, что большинство читателей данного
руководства желает в первую очередь решить свои непосредственные проблемы
и не слишком заинтересованы в смысле каждого выполняемого шага, лишь бы они все
в итоге привели к желаемому результату. При этом я с уважением отношусь к тем,
кто пожелает разобраться в смысле каждого действия.

*Текст, выделенный курсивом, можно смело пропускать, если вы не заинтересованы
в том, чтобы разобраться в смысле каждого выполняемого действия.*

## Зачем нужен прокси-сервер?

В наше непростое время проблемы с доступом к интернет-ресурсам наблюдаются
как в России, так и за ее ппределами. Например, экспаты испытывают трудности
с подключением к таким ресурсам, как [gosuslugi.ru](https://www.gosuslugi.ru/);
изнутри страны недоступны многие зарубежные сайты. Прокси-сервер, расположенный
на хостинге в государстве, не подверженном ограничениям, которые необходимо
обойти, решает вышеописанную задачу.

В этом руководстве будет рассмотрен процесс создания прокси-сервера внутри
России для обеспечения доступа из-за рубежа к ресурсам, доступ к которым в
настоящее время ограничен. Впрочем, обратная задача решается аналогичным путем;
единственная разница заключается в том, что потребуется выбрать провайдера
за границей, и с оплатой его услуг могут возникнуть сложности.

Я уже предвижу вопрос читателя: почему бы не воспользоваться публичным
сервисом VPN или прокси-сервером? Основное опасение заключается в том, что
подобные ресурсы рано или поздно начнут блокировать, а личный прокси-сервер,
которым пользуется один человек, - мелкая цель, которая долго останется
незамеченной.

## Что такое VPS/VDS?

VPS расшифровывается как Virtual private server, VDS - как virtual dedicated
server; оба термина обозначают одно и то же - 
[виртуальную машину](https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D0%B0),
предоставляемую вам провайдером; вы обладаете административным доступом к
установленной на данной виртуальной машине ОС.

## Выбор хостинга VPS/VDS

~~Здесь могла бы быть ваша реклама!~~ Если серьезно, автор данного руководства
не ангажирован ни одним провайдером, поэтому не намерен никого рекламировать.
Поскольку, как будет описано ниже, требования, предъявляемые к серверу прокси
минимальны, рекомендую выбрать самого дешевого провайдера, которого вы сможете
найти. Можно начать, скажем, с
[рейтинга](https://ru.hostings.info/hostings/rating/vps-vds)
провайдеров VPS/VDS; особенное внимание следует обратить на страну, в которой
расположен предоставляемый вам виртуальный сервер.

###Требования к конфигурации

Для личного прокси-сервера достаточно минимальных вычислительных ресурсов.
Хостинг-провайдеры предлагают выбор количества ядер процессора, доступной
оперативной памяти и объема жесткого диска (а также, возможно, и его типа -
HDD или SSD). В данном случае достаточно 1 ядра, 512 Мб оперативной памяти
и 10 Гб жесткого диска в наиболее дешевой конфигурации (если есть выбор).

##Установка виртуальной машины

TODO

###Выбор дистрибутива

В отличие от таких операционных систем, как Windows и Mac OS X, не существует
единой ОС Linux; вместо этого, доступно множество различных дистрибутивов
на любой вкус и для любой задачи.

В рамках данного руководства будет рассмотрено развертывание прокси-сервера
на базе дистрибутивов Ubuntu 20.04 и CentOS 8. Вы можете выбрать любой из
них.

*Часто можно встретить такие названия, как Linux и GNU/Linux; первое из
них, строго говоря, относится к
[ядру операционной системы](https://ru.wikipedia.org/wiki/%D0%AF%D0%B4%D1%80%D0%BE_%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B9_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B),
а второе - к комбинации ядра ОС и базового пользовательского окружения,
разработанного проектом GNU. Существует множество различных дистрибутивов
на базе ядра Linux (самый популярный из них - распространенная мобильная ОС
Android) или GNU/Linux.
некоторые из этих дистрибутивов предназначены для решения специальных задач -
например, установки на встраиваемое оборудование, такое, как роутеры, точки
доступа Wi-Fi, сетевые хранилища и т. п. - например,
[openwrt](https://openwrt.org/).*

*Другие дистрибутивы предназначены для решения широкого круга задач - они
могут использоваться и на серверах, и на десктопах; основные отличия между ними
зачастую сводятся к комбинации следующих факторов.*

*Способ поставки ПО: в большинстве дистрибутивов По предоставляется в заранее
скомпилированном виде, удобном для немедленной установки; примеры таких
дистрибутивов - Debian, Ubuntu, RHEL, CentOS, Fedora. При этом, в некоторых
дистрибутивах для энтузиастов ПО поставляется в исходных кодах, чтобы позволить
им задействовать оптимизации, специфичные для их собственного оборудования.
Пример такого дистрибутива - Gentoo.*

*Новизна vs стабильность: одни дистрибутивы стремятся к тому, чтобы поставлять
самые последние версии большинства приложений и библиотек, чтобы пользователи
имели доступ ко всему присутствующему в этих версиях новому функционалу. Ценой
подобного подхода являются возникающие время от времени проблемы с
совместимостью разных программ и библиотек.*

*Пример такого дистрибутива - ArchLinux.*

*Другие дистрибутивы жертвуют новизной ПО в пользу стабильности и отсутствия
проблем с совместимостью поставляемых программ друг с другом; однако, при
этом в поставляемых вместе с дистрибутивом версиях ПО отсутствует самый
новый функционал.*

*Примеры подобных дистрибутивов - RHEL/CentOS, Debian, Ubuntu.*

##Удаленное подключение к виртуальной машине

Для удаленного подключения к виртуальной машине будет использоваться протокол
SSH. Если вы используете ОС Windows, вам понадобится скачать
[инсталлятор](https://the.earth.li/~sgtatham/putty/latest/w64/putty-64bit-0.76-installer.msi)
популярного эмулятора терминала PuTTY; пользователям Mac OS X или любого
дистрибутива Linux достаточно будет открыть командную строку и воспользоваться
командой ssh.

TODO: описать процесс подключения к только что установленной виртуальной
машине.

###Командная строка

*У читателя может возникнуть совершенно законный вопрос: почему в 2022 году
предлагается использовать такой, казалось бы, примитивный инструмент для
управления ОС и приложениями на виртуальной машине, как командная строка?
Неужели нельзя воспользоваться графическим интерфейсом? Однако, командная
строка и в 2022 году не собирается сдавать позиции и в профессиональной среде
остается предпочтительным органом управления. на это есть следующие причины.*

* *Низкие требования к производительности сервера и пропускной способности
канала связи;*
* *удобство автоматизации рутины: набор действий, регулярно выполняемых вместе,
легко объединяется в скрипт;*
* *Расширяемость: удобно как добавлять команды, так и комбинировать их,
направляя результат работы одной команды на вход другой.*

##Обеспечение безопасности

TODO

##Установка прокси-сервера

Ubuntu 20.04:
```

```

CentOS 8:
```

```

##Конфигурация прокси-сервера

TODO

##Тестирование доступа

TODO
